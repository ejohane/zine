{"id":"zine-0dx","title":"Delete DO-specific database utilities","description":"Remove SQLite/DO database helper functions.\n\n## Files to Delete\n- apps/worker/src/lib/db.ts\n\n## Functions Being Removed\n- isMigrationApplied()\n- markMigrationApplied()\n- getVersion() - reads replicache_meta\n- incrementVersion() - updates replicache_meta\n\nAll operate on SqlStorage type (DO SQLite).\n\n## Depends On\n- Delete sync routes","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T21:38:02.455997-06:00","updated_at":"2025-12-13T22:16:19.632162-06:00","closed_at":"2025-12-13T22:16:19.632162-06:00"}
{"id":"zine-1ny","title":"Create tRPC-based item hooks for mobile","description":"Create new hooks using tRPC instead of Replicache.\n\n## New Files\n### apps/mobile/hooks/use-items.ts (replacement)\n```typescript\nimport { trpc } from '@/lib/trpc';\n\nexport function useInboxItems(filter?: FilterOptions) {\n  return trpc.items.inbox.useInfiniteQuery(\n    { filter, limit: 20 },\n    { getNextPageParam: (lastPage) =\u003e lastPage.nextCursor }\n  );\n}\n\nexport function useLibraryItems(filter?: FilterOptions) {\n  return trpc.items.library.useInfiniteQuery(...);\n}\n\nexport function useHomeData() {\n  return trpc.items.home.useQuery();\n}\n\nexport function useBookmarkItem() {\n  return trpc.items.bookmark.useMutation({\n    onMutate: async ({ id }) =\u003e { /* optimistic update */ },\n    onError: (err, vars, context) =\u003e { /* rollback */ },\n    onSettled: () =\u003e { /* invalidate */ },\n  });\n}\n\nexport function useArchiveItem() {\n  return trpc.items.archive.useMutation(...);\n}\n```\n\n## Key Patterns\n- useInfiniteQuery for paginated lists\n- Optimistic updates for mutations\n- Query invalidation on mutation success\n\n## Depends On\n- tRPC client created\n- TRPCProvider in place","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-13T21:39:13.634452-06:00","updated_at":"2025-12-13T21:39:13.634452-06:00"}
{"id":"zine-2rc","title":"Create tRPC context with auth and D1","description":"Create tRPC context that provides userId and database connection.\n\n## Implementation\n```typescript\n// apps/worker/src/trpc/context.ts\nimport { createDb } from '../db';\nimport type { Context } from 'hono';\nimport type { Env } from '../types';\n\nexport async function createContext(c: Context\u003cEnv\u003e) {\n  const userId = c.get('userId');\n  const db = createDb(c.env.DB);\n  return { userId, db, env: c.env };\n}\n\nexport type TRPCContext = Awaited\u003cReturnType\u003ctypeof createContext\u003e\u003e;\n```\n\n## New Files\n- apps/worker/src/trpc/context.ts\n\n## Depends On\n- D1 database initialization module\n- Auth middleware updated for tRPC","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-13T21:37:44.227102-06:00","updated_at":"2025-12-13T22:03:32.396249-06:00","closed_at":"2025-12-13T22:03:32.396249-06:00"}
{"id":"zine-3j2","title":"Document ingestion scheduler design","description":"Design and document the content ingestion pipeline for post-migration.\n\n## Current State\nIngestion runs in Durable Objects (handlers/ingest.ts).\n\n## New Architecture\nUse Cloudflare Scheduled Workers + D1:\n\n```toml\n# apps/worker/wrangler.toml\n[triggers]\ncrons = [\"0 * * * *\"]  # Run every hour\n```\n\n```typescript\nexport default {\n  fetch: app.fetch,\n  async scheduled(event, env, ctx) {\n    ctx.waitUntil(runIngestionBatch(env));\n  },\n};\n```\n\n## Design Decisions Needed\n- [ ] Ingestion frequency (hourly? on-demand?)\n- [ ] Provider-specific fetchers (YouTube, Spotify, RSS, Substack)\n- [ ] Error handling and retry strategy\n- [ ] Rate limiting for provider APIs\n\n## Output\nDocument in docs/zine-ingestion-pipeline.md (update existing)\n\n## Depends On\n- D1 schema includes providerItemsSeen table","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-13T21:40:29.310543-06:00","updated_at":"2025-12-13T21:40:29.310543-06:00"}
{"id":"zine-4gr","title":"Implement optimistic updates in mobile hooks","description":"Add optimistic update patterns for all mutations.\n\n## Mutations Needing Optimistic Updates\n1. **items.bookmark**\n   - Immediately remove from inbox query\n   - Add to library query\n   - Rollback on error\n\n2. **items.archive**\n   - Immediately remove from inbox/library query\n   - Rollback on error\n\n3. **items.updateProgress**\n   - Update progress in cache\n   - No rollback needed (fire-and-forget)\n\n## Pattern\n```typescript\nconst bookmark = trpc.items.bookmark.useMutation({\n  onMutate: async ({ id }) =\u003e {\n    await queryClient.cancelQueries({ queryKey: ['items', 'inbox'] });\n    const previousItems = queryClient.getQueryData(['items', 'inbox']);\n    \n    queryClient.setQueryData(['items', 'inbox'], (old) =\u003e\n      old?.items.filter((item) =\u003e item.id !== id)\n    );\n    \n    return { previousItems };\n  },\n  onError: (err, { id }, context) =\u003e {\n    queryClient.setQueryData(['items', 'inbox'], context?.previousItems);\n  },\n  onSettled: () =\u003e {\n    queryClient.invalidateQueries({ queryKey: ['items'] });\n  },\n});\n```\n\n## Depends On\n- tRPC-based hooks created","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-13T21:40:22.323462-06:00","updated_at":"2025-12-13T21:40:22.323462-06:00"}
{"id":"zine-4i2","title":"Create mock data for tRPC development","description":"Create mock ItemView data for API development before D1 integration.\n\n## Implementation\n- Create MOCK_ITEMS array with realistic content\n- Use ContentType, Provider, UserItemState enums (UPPERCASE values)\n- Include examples for all content types and states\n- Helper functions: getMockInboxItems(), getMockLibraryItems(), getMockHomeData()\n\n## New Files\n- apps/worker/src/trpc/mock-data.ts\n\n## Mock Data Coverage\n- Videos from YouTube\n- Podcasts from Spotify\n- Articles from Substack/RSS\n- Items in INBOX, BOOKMARKED, ARCHIVED states\n- Items with progress tracking\n\n## Depends On\n- tRPC instance created","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T21:38:07.670313-06:00","updated_at":"2025-12-13T22:07:04.508517-06:00","closed_at":"2025-12-13T22:07:04.508517-06:00"}
{"id":"zine-4s9","title":"Update auth middleware for tRPC context","description":"Ensure auth middleware works with tRPC context.\n\n## Changes to apps/worker/src/middleware/auth.ts\n- Verify JWT and set userId on Hono context\n- Ensure c.set('userId', ...) is available for tRPC context\n- Keep existing Clerk JWT verification logic\n\n## Integration\nThe tRPC context reads userId from:\n```typescript\nconst userId = c.get('userId');\n```\n\n## Depends On\n- Nothing (can be done early)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T21:38:36.549854-06:00","updated_at":"2025-12-13T22:00:15.036266-06:00","closed_at":"2025-12-13T22:00:15.036266-06:00"}
{"id":"zine-5qn","title":"Create tRPC client for mobile","description":"Create tRPC client setup for mobile app.\n\n## New Files\n### apps/mobile/lib/trpc.ts\n```typescript\nimport { createTRPCReact } from '@trpc/react-query';\nimport type { AppRouter } from '@zine/worker/src/trpc/router';\n\nexport const trpc = createTRPCReact\u003cAppRouter\u003e();\n```\n\n## TypeScript Configuration\nUpdate apps/mobile/tsconfig.json:\n```json\n{\n  \"compilerOptions\": {\n    \"paths\": {\n      \"@zine/worker/*\": [\"../worker/src/*\"]\n    }\n  }\n}\n```\n\n## Depends On\n- Worker exports AppRouter type\n- tRPC deps installed in mobile","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-13T21:38:53.884278-06:00","updated_at":"2025-12-13T21:38:53.884278-06:00"}
{"id":"zine-5um","title":"Create database query tests","description":"Write tests for Drizzle database queries.\n\n## New Files\n- apps/worker/src/db/queries.test.ts\n\n## Test Cases\n- Insert and query users\n- Insert items with unique constraint\n- Insert userItems with state transitions\n- Query inbox with pagination cursor\n- Query library sorted by bookmarkedAt\n- Soft delete sources\n- Idempotency check with providerItemsSeen\n\n## Setup\n- Use in-memory SQLite or D1 local mode\n- Seed test data before each test\n\n## Depends On\n- Drizzle schema created\n- D1 initialization module","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-13T21:39:55.681436-06:00","updated_at":"2025-12-13T21:39:55.681436-06:00"}
{"id":"zine-66l","title":"Create tRPC instance and base procedures","description":"Set up tRPC with base router and protected procedure.\n\n## Implementation\n```typescript\n// apps/worker/src/trpc/trpc.ts\nimport { initTRPC, TRPCError } from '@trpc/server';\nimport superjson from 'superjson';\nimport type { TRPCContext } from './context';\n\nconst t = initTRPC.context\u003cTRPCContext\u003e().create({\n  transformer: superjson, // Required for Date serialization\n});\n\nexport const router = t.router;\nexport const publicProcedure = t.procedure;\n\nexport const protectedProcedure = t.procedure.use(async ({ ctx, next }) =\u003e {\n  if (!ctx.userId) {\n    throw new TRPCError({ code: 'UNAUTHORIZED' });\n  }\n  return next({ ctx: { ...ctx, userId: ctx.userId } });\n});\n```\n\n## New Files\n- apps/worker/src/trpc/trpc.ts\n\n## Dependencies\n- **zine-udw.1.1** (Add dependencies) - need @trpc/server, superjson installed\n\n## Note\nThe superjson transformer is required for proper Date serialization. Must match client configuration.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-13T21:37:39.909624-06:00","updated_at":"2025-12-13T22:03:02.009965-06:00","closed_at":"2025-12-13T22:03:02.009965-06:00"}
{"id":"zine-69u","title":"Refactor auth routes for D1","description":"Update auth webhook handlers to use D1 instead of Durable Objects.\n\n## Changes to apps/worker/src/routes/auth.ts\n### handleUserCreated()\n- Remove: `env.USER_DO.idFromName()` and `stub.fetch('/init')`\n- Add: Insert into D1 users table via Drizzle\n\n### handleUserDeleted()\n- Remove: DO cleanup call\n- Add: D1 cleanup (soft delete or cascade delete)\n\n### /me endpoint\n- Remove: DO fetch\n- Add: D1 query for user profile\n\n### /account DELETE\n- Remove: DO deletion\n- Add: D1 deletion with GDPR compliance\n\n## Keep Unchanged\n- Webhook verification (Svix)\n- JWT validation\n\n## Depends On\n- D1 database initialization module\n- Drizzle schema created","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T21:38:33.15249-06:00","updated_at":"2025-12-13T22:13:53.61393-06:00","closed_at":"2025-12-13T22:13:53.61393-06:00"}
{"id":"zine-6d0","title":"Create D1 database initialization module","description":"Create the database client initialization module.\n\n## Implementation\n```typescript\n// apps/worker/src/db/index.ts\nimport { drizzle } from 'drizzle-orm/d1';\nimport * as schema from './schema';\n\nexport function createDb(d1: D1Database) {\n  return drizzle(d1, { schema });\n}\n\nexport type Database = ReturnType\u003ctypeof createDb\u003e;\n```\n\n## New Files\n- apps/worker/src/db/index.ts\n\n## Depends On\n- Drizzle schema created","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-13T21:37:31.478182-06:00","updated_at":"2025-12-13T22:02:49.409098-06:00","closed_at":"2025-12-13T22:02:49.409098-06:00"}
{"id":"zine-6zg","title":"Integrate tRPC with Hono in worker entry","description":"Update worker entry point to use tRPC instead of sync routes.\n\n## Changes to apps/worker/src/index.ts\n### Remove\n- UserDO export\n- sync routes import\n- /api/replicache/* routes\n\n### Add\n- tRPC adapter import (@hono/trpc-server)\n- /trpc/* route with auth middleware\n- Context creation for each request\n\n## Implementation\n```typescript\nimport { trpcServer } from '@hono/trpc-server';\nimport { appRouter } from './trpc/router';\nimport { createContext } from './trpc/context';\n\napp.use('/trpc/*', authMiddleware());\napp.use('/trpc/*', trpcServer({\n  router: appRouter,\n  createContext,\n}));\n```\n\n## Depends On\n- Root tRPC router created\n- Auth middleware updated","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T21:38:19.795661-06:00","updated_at":"2025-12-13T22:12:13.206262-06:00","closed_at":"2025-12-13T22:12:13.206262-06:00"}
{"id":"zine-76o","title":"Update shared schemas - remove sync schemas","description":"Remove Replicache-specific schemas from shared package.\n\n## Changes to packages/shared/src/schemas/index.ts\n### Remove\n- Mutation schemas (lines ~74-142)\n- Sync schemas (lines ~151-181)\n- Patch/Pull response schemas (lines ~186-208)\n- Client metadata schema (lines ~212-218)\n\n### Keep\n- Enum schemas: ContentTypeSchema, ProviderSchema, UserItemStateSchema\n- Domain schemas: ItemSchema, UserItemSchema, SourceSchema\n\n## Depends On\n- No code imports removed schemas","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-13T21:39:35.804105-06:00","updated_at":"2025-12-13T21:39:35.804105-06:00"}
{"id":"zine-874","title":"Configure wrangler.toml for D1 database","description":"Update wrangler.toml to remove Durable Objects and add D1 bindings.\n\n## Remove\n- USER_DO binding\n- DO migrations section\n\n## Add\n- D1 bindings for dev/staging/prod environments\n\n## Files\n- apps/worker/wrangler.toml\n\n## Depends On\n- Create D1 databases in Cloudflare (need database IDs)","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-13T21:37:04.687487-06:00","updated_at":"2025-12-13T21:46:02.51816-06:00","closed_at":"2025-12-13T21:46:02.51816-06:00"}
{"id":"zine-8uh","title":"Create items tRPC router with mock data","description":"Implement items router with mock data first approach.\n\n## Procedures\n### Queries\n- items.inbox - paginated inbox items with filter\n- items.library - paginated library items with filter\n- items.home - curated home sections\n- items.get - single item by ID\n\n### Mutations\n- items.bookmark - move to BOOKMARKED\n- items.archive - move to ARCHIVED\n- items.updateProgress - update playback position\n\n## Input Validation\n- Use Zod schemas with UPPERCASE enum values\n- Cursor-based pagination\n- Optional filter by provider/contentType\n\n## New Files\n- apps/worker/src/trpc/routers/items.ts\n\n## Depends On\n- Mock data created\n- tRPC instance created","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T21:38:12.036526-06:00","updated_at":"2025-12-13T22:08:08.502857-06:00","closed_at":"2025-12-13T22:08:08.502857-06:00"}
{"id":"zine-8x3","title":"Delete Replicache types from shared package","description":"Remove Replicache-specific sync types.\n\n## Files to Delete\n- packages/shared/src/types/sync.ts\n\n## Exports Being Removed\n- SCHEMA_VERSION\n- BaseMutation, BookmarkItemMutation, ArchiveItemMutation, etc.\n- Mutation union type\n- PushRequest, PushResponse\n- PullCookie, PullRequest, PatchOperation, PullResponse\n- ClientMetadata\n\n## Depends On\n- Mobile no longer imports these types","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-13T21:39:21.093746-06:00","updated_at":"2025-12-13T21:39:21.093746-06:00"}
{"id":"zine-aie","title":"Create items router unit tests","description":"Write unit tests for items tRPC router.\n\n## New Files\n- apps/worker/src/trpc/routers/items.test.ts\n\n## Test Cases\n### Queries\n- items.inbox returns paginated items\n- items.inbox filters by provider\n- items.inbox filters by contentType\n- items.library returns bookmarked items\n- items.home returns all sections\n- items.get returns single item\n- items.get throws NOT_FOUND for missing item\n\n### Mutations\n- items.bookmark updates state\n- items.archive updates state\n- items.updateProgress stores progress\n\n### Auth\n- Unauthenticated requests return UNAUTHORIZED\n\n## Tech\n- Use Vitest with @cloudflare/vitest-pool-workers\n- Mock D1 database for unit tests\n\n## Depends On\n- Items router implemented","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-13T21:39:48.800261-06:00","updated_at":"2025-12-13T21:39:48.800261-06:00"}
{"id":"zine-b20","title":"Create drizzle.config.ts","description":"Create Drizzle Kit configuration for D1 migrations.\n\n## New Files\n- apps/worker/drizzle.config.ts\n\n## Add npm scripts to package.json\n- db:generate\n- db:migrate\n- db:push\n- db:studio\n\n## Depends On\n- Add D1 + Drizzle dependencies","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-13T21:37:09.489902-06:00","updated_at":"2025-12-13T21:46:03.487864-06:00","closed_at":"2025-12-13T21:46:03.487864-06:00"}
{"id":"zine-bdw","title":"Create root tRPC router","description":"Create the main AppRouter combining all sub-routers.\n\n## Implementation\n```typescript\n// apps/worker/src/trpc/router.ts\nimport { router } from './trpc';\nimport { itemsRouter } from './routers/items';\nimport { sourcesRouter } from './routers/sources';\n\nexport const appRouter = router({\n  items: itemsRouter,\n  sources: sourcesRouter,\n});\n\nexport type AppRouter = typeof appRouter;\n```\n\n## New Files\n- apps/worker/src/trpc/router.ts\n\n## Dependencies\n- **zine-66l** (tRPC instance) - need router function\n- **zine-8uh** (Items router) - need itemsRouter export\n- **zine-gu3** (Sources router) - need sourcesRouter export\n\n## Note\nThis must be complete before zine-6zg (Hono integration) and zine-snp (type exports).","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-13T21:37:47.226166-06:00","updated_at":"2025-12-13T22:07:03.010054-06:00","closed_at":"2025-12-13T22:07:03.010054-06:00"}
{"id":"zine-boc","title":"Update mobile _layout.tsx providers","description":"Replace ReplicacheProvider with TRPCProvider in root layout.\n\n## Changes to apps/mobile/app/_layout.tsx\n### Remove\n```typescript\nimport { ReplicacheProvider } from '@/providers/replicache-provider';\n// And JSX wrapper:\n\u003cReplicacheProvider\u003e...\u003c/ReplicacheProvider\u003e\n```\n\n### Add\n```typescript\nimport { TRPCProvider } from '@/providers/trpc-provider';\n// And JSX wrapper:\n\u003cTRPCProvider\u003e...\u003c/TRPCProvider\u003e\n```\n\n## Depends On\n- TRPCProvider created","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-13T21:39:02.581813-06:00","updated_at":"2025-12-13T21:39:02.581813-06:00"}
{"id":"zine-bt9","title":"Implement cursor-based pagination utilities","description":"Create reusable cursor pagination for tRPC queries.\n\n## Implementation\n```typescript\n// apps/worker/src/lib/pagination.ts\ninterface PaginationCursor {\n  sortValue: string; // ISO8601 timestamp\n  id: string;\n}\n\nexport function encodeCursor(cursor: PaginationCursor): string {\n  return Buffer.from(JSON.stringify(cursor)).toString('base64url');\n}\n\nexport function decodeCursor(encoded: string): PaginationCursor {\n  return JSON.parse(Buffer.from(encoded, 'base64url').toString());\n}\n\nexport function buildPaginatedQuery\u003cT\u003e({\n  query,\n  cursor,\n  limit,\n  sortField,\n  idField,\n}: PaginationOptions\u003cT\u003e) {\n  // Implementation per analysis doc\n}\n```\n\n## Usage\nAll list queries (inbox, library, sources) use this pattern.\n\n## Depends On\n- D1 database setup","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T21:40:15.70742-06:00","updated_at":"2025-12-13T22:28:14.649536-06:00","closed_at":"2025-12-13T22:28:14.649536-06:00"}
{"id":"zine-c3j","title":"Remove Replicache from shared package.json","description":"Clean up package.json after removing Replicache code.\n\n## Changes to packages/shared/package.json\n### Remove\n```json\n\"peerDependencies\": {\n  \"replicache\": \"^15.0.0\"\n},\n\"peerDependenciesMeta\": {\n  \"replicache\": { \"optional\": true }\n},\n\"devDependencies\": {\n  \"replicache\": \"^15.0.0\",\n  ...\n}\n```\n\n### Remove exports for deleted modules\n```json\n\"./mutators\": { ... },\n\"./constants\": { ... }\n```\n\n## Depends On\n- All Replicache code deleted from shared","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-13T21:39:39.328575-06:00","updated_at":"2025-12-13T21:39:39.328575-06:00"}
{"id":"zine-c3l","title":"Delete Durable Objects directory","description":"Remove entire durable-objects directory with all handlers.\n\n## Files to Delete\n- apps/worker/src/durable-objects/user-do.ts\n- apps/worker/src/durable-objects/user-do.test.ts\n- apps/worker/src/durable-objects/schema.ts\n- apps/worker/src/durable-objects/handlers/init.ts\n- apps/worker/src/durable-objects/handlers/push.ts\n- apps/worker/src/durable-objects/handlers/pull.ts\n- apps/worker/src/durable-objects/handlers/ingest.ts\n\n## Why\n- UserDO class uses embedded SQLite (replaced by D1)\n- Replicache sync handlers no longer needed\n- Schema.ts contains DO-specific migrations\n\n## Critical Dependencies\n- **zine-6zg** (Integrate tRPC with Hono) - must be complete first\n- **zine-udw.1.2** (wrangler.toml) - DO bindings must be removed first\n\n**WARNING: Deleting before tRPC is wired up will break the app!**","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T21:37:56.058317-06:00","updated_at":"2025-12-13T22:15:58.564773-06:00","closed_at":"2025-12-13T22:15:58.564773-06:00"}
{"id":"zine-cyh","title":"Update worker types.ts for D1 binding","description":"Update Bindings interface for new architecture.\n\n## Changes to apps/worker/src/types.ts\n### Remove\n```typescript\nUSER_DO: DurableObjectNamespace;\n```\n\n### Add\n```typescript\nDB: D1Database;\n```\n\n## Keep Unchanged\n- WEBHOOK_IDEMPOTENCY\n- ENVIRONMENT\n- CLERK_* variables\n- Variables, Env, AppContext types\n\n## Depends On\n- wrangler.toml updated with D1 bindings","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T21:38:27.855296-06:00","updated_at":"2025-12-13T22:03:04.661635-06:00","closed_at":"2025-12-13T22:03:04.661635-06:00"}
{"id":"zine-e4j","title":"Add tRPC and React Query deps to mobile","description":"Update mobile package.json for new data layer.\n\n## Changes to apps/mobile/package.json\n### Remove\n```json\n\"replicache\": \"^15.0.0\",\n\"replicache-react\": \"^5.0.0\",\n```\n\n### Add\n```json\n\"@tanstack/react-query\": \"^5.x.x\",\n\"@trpc/client\": \"^11.x.x\",\n\"@trpc/react-query\": \"^11.x.x\"\n```\n\n## Post-Update\n- Run bun install\n- Verify no broken imports yet (will fix in subsequent tasks)\n\n## Depends On\n- Worker tRPC router exports type","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-13T21:38:50.035913-06:00","updated_at":"2025-12-13T21:38:50.035913-06:00"}
{"id":"zine-fxk","title":"Create TRPCProvider for mobile","description":"Create React Query + tRPC provider component.\n\n## New Files\n### apps/mobile/providers/trpc-provider.tsx\n- Create QueryClient with useState (not module scope)\n- Create tRPC client with httpBatchLink + superjson\n- Configure Authorization header with Clerk token\n- Export TRPCProvider component\n\n## Implementation\n```typescript\nimport { useState } from 'react';\nimport { QueryClient, QueryClientProvider } from '@tanstack/react-query';\nimport { httpBatchLink } from '@trpc/client';\nimport { useAuth } from '@clerk/clerk-expo';\nimport superjson from 'superjson';\nimport { trpc } from '@/lib/trpc';\n\nexport function TRPCProvider({ children }) {\n  const { getToken } = useAuth();\n\n  // useState to avoid SSR/hydration issues\n  const [queryClient] = useState(() =\u003e new QueryClient({...}));\n  const [trpcClient] = useState(() =\u003e trpc.createClient({\n    transformer: superjson,\n    links: [httpBatchLink({\n      url: `${API_URL}/trpc`,\n      headers: async () =\u003e {\n        const token = await getToken();\n        return token ? { Authorization: `Bearer ${token}` } : {};\n      },\n    })],\n  }));\n\n  return (\n    \u003ctrpc.Provider client={trpcClient} queryClient={queryClient}\u003e\n      \u003cQueryClientProvider client={queryClient}\u003e\n        {children}\n      \u003c/QueryClientProvider\u003e\n    \u003c/trpc.Provider\u003e\n  );\n}\n```\n\n## Dependencies\n- **zine-5qn** (tRPC client) - need trpc export\n- **zine-e4j** (Add deps) - need @tanstack/react-query, superjson\n\n## Critical Notes\n- superjson transformer MUST match server configuration\n- useState pattern prevents React hydration issues\n- getToken from useAuth (Clerk) for authorization","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-13T21:38:59.646129-06:00","updated_at":"2025-12-13T21:47:32.682433-06:00"}
{"id":"zine-gu3","title":"Create sources tRPC router with mock data","description":"Implement sources router with mock data first approach.\n\n## Procedures\n### Queries\n- sources.list - user's subscribed sources (excludes soft-deleted)\n\n### Mutations\n- sources.add - subscribe to new source\n- sources.remove - soft delete source\n\n## Input Validation\n- Provider enum (UPPERCASE)\n- feedUrl validation\n- Optional name (auto-derived if not provided)\n\n## New Files\n- apps/worker/src/trpc/routers/sources.ts\n\n## Depends On\n- Mock data created\n- tRPC instance created","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T21:38:15.206307-06:00","updated_at":"2025-12-13T22:08:01.384733-06:00","closed_at":"2025-12-13T22:08:01.384733-06:00"}
{"id":"zine-hq3","title":"Create sources router unit tests","description":"Write unit tests for sources tRPC router.\n\n## New Files\n- apps/worker/src/trpc/routers/sources.test.ts\n\n## Test Cases\n### Queries\n- sources.list returns user's sources\n- sources.list excludes soft-deleted sources\n\n### Mutations\n- sources.add creates new source\n- sources.add validates provider enum\n- sources.remove soft deletes source\n- sources.add returns CONFLICT for duplicate\n\n### Auth\n- Unauthenticated requests return UNAUTHORIZED\n\n## Depends On\n- Sources router implemented","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-13T21:39:51.818765-06:00","updated_at":"2025-12-13T21:39:51.818765-06:00"}
{"id":"zine-j8s","title":"Create Drizzle schema for D1 database","description":"Create the complete Drizzle ORM schema for D1.\n\n## Tables\n1. **users** - Clerk user ID, email, timestamps\n2. **items** - Canonical content (shared across users)\n3. **userItems** - User's relationship to content (state, progress, timestamps)\n4. **sources** - User subscriptions (with soft delete)\n5. **providerItemsSeen** - Ingestion idempotency tracking\n\n## Key Design Decisions\n- All enum values stored as UPPERCASE (VIDEO, PODCAST, YOUTUBE, etc.)\n- userId required on userItems and sources for multi-tenant D1\n- Unique index on (provider, providerId) for items\n- Soft delete on sources via deletedAt\n\n## New Files\n- apps/worker/src/db/schema.ts\n\n## Depends On\n- drizzle.config.ts created","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-13T21:37:28.443891-06:00","updated_at":"2025-12-13T22:00:15.74767-06:00","closed_at":"2025-12-13T22:00:15.74767-06:00"}
{"id":"zine-kce","title":"Generate and apply initial D1 migration","description":"Generate Drizzle migration from schema and apply to D1.\n\n## Steps\n1. Run `bun run db:generate` to create migration files\n2. Review generated SQL in src/db/migrations/\n3. Apply to local: `wrangler d1 migrations apply zine-db --local`\n4. Apply to staging: `wrangler d1 migrations apply zine-db-staging --env staging`\n\n## New Directory\n- apps/worker/src/db/migrations/\n\n## Depends On\n- Drizzle schema created\n- D1 databases created in Cloudflare","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-13T21:37:35.407336-06:00","updated_at":"2025-12-13T22:29:10.453923-06:00","closed_at":"2025-12-13T22:29:10.453923-06:00"}
{"id":"zine-l6q","title":"Update shared index.ts exports","description":"Remove deleted module exports from shared package.\n\n## Changes to packages/shared/src/index.ts\n### Remove\n- sync types exports\n- key conventions exports\n- sync schemas exports\n- mutators exports\n\n### Keep\n- Domain types (Item, UserItem, Source, etc.)\n- ZINE_VERSION\n- Enum schemas (ContentTypeSchema, ProviderSchema, UserItemStateSchema)\n- Domain schemas (ItemSchema, UserItemSchema, SourceSchema)\n\n## Depends On\n- sync.ts, mutators/index.ts, keys.ts deleted","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-13T21:39:32.313731-06:00","updated_at":"2025-12-13T21:39:32.313731-06:00"}
{"id":"zine-lqw","title":"Delete sync routes and tests","description":"Remove Replicache sync route handlers.\n\n## Files to Delete\n- apps/worker/src/routes/sync.ts\n- apps/worker/src/routes/sync.test.ts\n\n## Contents Being Removed\n- /api/replicache/push endpoint\n- /api/replicache/pull endpoint\n- PushRequestSchema/PullRequestSchema validation\n- Direct Durable Object usage\n\n## Depends On\n- Delete Durable Objects directory","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T21:37:59.054807-06:00","updated_at":"2025-12-13T22:16:06.715673-06:00","closed_at":"2025-12-13T22:16:06.715673-06:00"}
{"id":"zine-nko","title":"Delete key conventions from shared package","description":"Remove Replicache key-value store conventions.\n\n## Files to Delete\n- packages/shared/src/constants/keys.ts\n\n## Exports Being Removed\n- KEY_PREFIX\n- itemKey(), userItemKey(), sourceKey()\n- parseKeyType(), parseKeyId()\n- isItemKey(), isUserItemKey(), isSourceKey()\n- itemScanPrefix(), userItemScanPrefix(), sourceScanPrefix()\n\n## Keep\n- packages/shared/src/constants/index.ts (exports ZINE_VERSION)\n\n## Depends On\n- Mobile and worker no longer use key functions","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-13T21:39:28.193697-06:00","updated_at":"2025-12-13T21:39:28.193697-06:00"}
{"id":"zine-pce","title":"Delete Replicache mobile files","description":"Remove Replicache-related files from mobile app.\n\n## Files to Delete\n- apps/mobile/lib/replicache.ts\n- apps/mobile/providers/replicache-provider.tsx\n- apps/mobile/hooks/use-items.ts\n- apps/mobile/lib/mock-data.ts\n\n## Why\n- replicache.ts: Creates Replicache instance with push/pull URLs\n- replicache-provider.tsx: React context for Replicache\n- use-items.ts: Uses useSubscribe from replicache-react\n- mock-data.ts: Uses WriteTransaction from Replicache\n\n## Critical Dependencies\n- **zine-boc** (Update _layout.tsx) - TRPCProvider must replace ReplicacheProvider first\n- **zine-1ny** (New tRPC hooks) - must have replacement hooks before deleting old ones\n\n**WARNING: Deleting before TRPCProvider is in place will crash the app!**","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-13T21:39:06.839085-06:00","updated_at":"2025-12-13T21:47:06.387637-06:00"}
{"id":"zine-ry6","title":"Verify CI pipeline passes","description":"Ensure CI builds and tests pass after migration.\n\n## Checks\n- TypeScript compilation (no errors)\n- ESLint passes\n- Unit tests pass\n- Integration tests pass\n- Worker deploys to staging\n\n## CI File\n- .github/workflows/ci.yml\n\n## Acceptance Criteria\n- [ ] `bun run build` succeeds in all packages\n- [ ] `bun run lint` passes\n- [ ] `bun run test` passes\n- [ ] No type errors in strict mode\n- [ ] Worker deploys to staging environment\n\n## Depends On\n- All migration tasks complete","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-13T21:40:02.826999-06:00","updated_at":"2025-12-13T21:40:02.826999-06:00"}
{"id":"zine-snp","title":"Add tRPC type exports to worker package.json","description":"Configure worker package.json to export tRPC types for mobile import.\n\n## Changes to apps/worker/package.json\n### Add exports field\n```json\n{\n  \"name\": \"@zine/worker\",\n  \"exports\": {\n    \"./trpc\": {\n      \"types\": \"./src/trpc/router.ts\"\n    }\n  }\n}\n```\n\n## Why\nMobile app needs to import AppRouter type:\n```typescript\nimport type { AppRouter } from '@zine/worker/trpc';\n```\n\n## Depends On\n- Root tRPC router created","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T21:40:10.487122-06:00","updated_at":"2025-12-13T22:11:32.341908-06:00","closed_at":"2025-12-13T22:11:32.341908-06:00"}
{"id":"zine-tiw","title":"Create D1 databases in Cloudflare","description":"Create D1 databases for staging and production.\n\n## Commands\n```bash\nwrangler d1 create zine-db-staging\nwrangler d1 create zine-db-production\n```\n\n## Acceptance Criteria\n- [ ] Staging D1 database created\n- [ ] Production D1 database created\n- [ ] Database IDs recorded for wrangler.toml","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-13T21:37:06.94323-06:00","updated_at":"2025-12-13T21:46:01.75988-06:00","closed_at":"2025-12-13T21:46:01.75988-06:00"}
{"id":"zine-tn7","title":"Update domain.ts types for D1 schema","description":"Update shared types to match new D1 schema requirements.\n\n**NOTE: This should be done early in Phase 1, not Phase 4. It's foundational for the Drizzle schema.**\n\n## Changes to packages/shared/src/types/domain.ts\n### Item interface\n- Add: `provider` field (required) - currently missing\n- Rename: `author` → `creator` (matches schema)\n- Make required: `providerId`, `canonicalUrl`, `title`\n\n### UserItem interface\n- Add: `userId` (critical for D1 multi-tenant queries)\n- Add: `progressPosition`, `progressDuration`, `progressUpdatedAt`\n- Add: `createdAt`, `updatedAt`\n\n### Source interface\n- Add: `userId` (required for D1)\n- Add: `feedUrl` (different from providerId)\n- Add: `updatedAt`, `deletedAt`\n\n## Keep Unchanged\n- ContentType enum (UPPERCASE)\n- Provider enum (UPPERCASE)\n- UserItemState enum (UPPERCASE)\n\n## Impact\nBreaking changes for existing code - update Drizzle schema to match.\n\n## Dependencies\n- None (foundational task)\n\n## Recommended Timing\nExecute during Phase 1 alongside schema creation.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T21:38:41.85925-06:00","updated_at":"2025-12-13T22:00:21.275848-06:00","closed_at":"2025-12-13T22:00:21.275848-06:00"}
{"id":"zine-tqz","title":"Delete mutators from shared package","description":"Remove Replicache mutator implementations.\n\n## Files to Delete\n- packages/shared/src/mutators/index.ts\n\n## Exports Being Removed\n- mutators object (uses WriteTransaction)\n- Mutators type\n- BookmarkItemArgs, ArchiveItemArgs, etc.\n- toJSONValue() helper\n\n## Note\nSome arg types could be repurposed for tRPC inputs but simpler to define fresh in router.\n\n## Depends On\n- Mobile no longer imports mutators","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-13T21:39:24.632508-06:00","updated_at":"2025-12-13T21:39:24.632508-06:00"}
{"id":"zine-u8q","title":"Create API integration tests","description":"Write end-to-end API tests.\n\n## New Files\n- apps/worker/src/integration/api.test.ts\n\n## Test Cases\n- Full flow: auth → inbox → bookmark → library\n- Pagination through large result sets\n- Error handling for invalid inputs\n- Auth webhook creates user in D1\n\n## Setup\n- Use wrangler dev for local testing\n- Mock Clerk JWT for auth\n- Seed D1 with test data\n\n## Depends On\n- All tRPC routers implemented\n- Auth routes refactored","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-13T21:39:59.073638-06:00","updated_at":"2025-12-13T21:39:59.073638-06:00"}
{"id":"zine-udw","title":"Backend Rearchitecture: Replicache + DO → tRPC + D1 + Drizzle","description":"Migrate from current Replicache + Durable Objects + SQLite architecture to Cloudflare + Hono + tRPC + D1 + Drizzle stack.\n\n## Goals\n- Remove Replicache sync protocol complexity\n- Replace per-user Durable Objects with shared D1 database\n- Implement type-safe tRPC API layer\n- Maintain existing enum casing (UPPERCASE)\n- Accept online-only for MVP (defer offline support)\n\n## Key Decisions\n- Zero-state migration acceptable (pre-launch)\n- Mock data first approach for API development\n- UPPERCASE enum values preserved for backward compatibility\n\n## References\n- Analysis: features/rearch/analysis.md\n- Experience Architecture: docs/zine-experience-architecture.md\n- Tech Stack: docs/zine-tech-stack.md","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-13T21:36:00.3586-06:00","updated_at":"2025-12-13T21:36:00.3586-06:00"}
{"id":"zine-udw-1-1","title":"Add D1 + Drizzle dependencies to worker package.json","description":"Add required dependencies for the new architecture:\n\n## Dependencies to Add\n```json\n{\n  \"dependencies\": {\n    \"drizzle-orm\": \"^0.34.0\",\n    \"@hono/trpc-server\": \"^0.3.0\",\n    \"@trpc/server\": \"^11.0.0\",\n    \"superjson\": \"^2.2.0\",\n    \"zod\": \"^3.23.0\"\n  },\n  \"devDependencies\": {\n    \"drizzle-kit\": \"^0.28.0\"\n  }\n}\n```\n\n## Files\n- apps/worker/package.json\n\n## Acceptance Criteria\n- [ ] drizzle-orm added to dependencies\n- [ ] drizzle-kit added to devDependencies\n- [ ] @hono/trpc-server added\n- [ ] @trpc/server added\n- [ ] superjson added (for Date serialization)\n- [ ] zod added (for input validation)\n- [ ] bun install succeeds\n- [ ] TypeScript can import from all new packages\n\n## Note\nzod may already be present - verify before adding duplicate.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-13T21:36:10.514716-06:00","updated_at":"2025-12-13T22:27:02.872616-06:00","closed_at":"2025-12-13T22:27:02.872616-06:00","dependencies":[{"issue_id":"zine-udw-1-1","depends_on_id":"zine-udw.1","type":"parent-child","created_at":"2025-12-13T21:36:10.515128-06:00","created_by":"daemon"}]}
{"id":"zine-udw-1-2","title":"Configure wrangler.toml for D1 database binding","description":"Update wrangler.toml to remove Durable Objects and add D1 bindings.\n\n## Remove\n```toml\n[[durable_objects.bindings]]\nname = \"USER_DO\"\nclass_name = \"UserDO\"\n\n[[migrations]]\ntag = \"v1\"\nnew_sqlite_classes = [\"UserDO\"]\n```\n\n## Add\n```toml\n[[d1_databases]]\nbinding = \"DB\"\ndatabase_name = \"zine-db\"\ndatabase_id = \"\u003cYOUR_D1_DATABASE_ID\u003e\"\n\n[env.development]\n[[env.development.d1_databases]]\nbinding = \"DB\"\ndatabase_name = \"zine-db-local\"\ndatabase_id = \"local\"\n\n[env.staging]\n[[env.staging.d1_databases]]\nbinding = \"DB\"\ndatabase_name = \"zine-db-staging\"\ndatabase_id = \"\u003cSTAGING_D1_DATABASE_ID\u003e\"\n\n[env.production]\n[[env.production.d1_databases]]\nbinding = \"DB\"\ndatabase_name = \"zine-db-production\"\ndatabase_id = \"\u003cPRODUCTION_D1_DATABASE_ID\u003e\"\n```\n\n## Files\n- apps/worker/wrangler.toml\n\n## Acceptance Criteria\n- [ ] USER_DO binding removed\n- [ ] DO migrations section removed\n- [ ] D1 bindings added for dev/staging/prod\n- [ ] wrangler dev starts without errors","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-13T21:36:17.591017-06:00","updated_at":"2025-12-13T22:27:24.895171-06:00","closed_at":"2025-12-13T22:27:24.895171-06:00","dependencies":[{"issue_id":"zine-udw-1-2","depends_on_id":"zine-udw.1","type":"parent-child","created_at":"2025-12-13T21:36:17.591395-06:00","created_by":"daemon"}]}
{"id":"zine-udw-1-3","title":"Create D1 databases in Cloudflare","description":"Create D1 databases for staging and production environments.\n\n## Commands\n```bash\n# Create staging database\nwrangler d1 create zine-db-staging\n\n# Create production database\nwrangler d1 create zine-db-production\n```\n\n## Post-Creation\n1. Copy database IDs from command output\n2. Update wrangler.toml with actual database IDs\n3. Verify databases appear in Cloudflare dashboard\n\n## Files\n- apps/worker/wrangler.toml (update with IDs)\n\n## Acceptance Criteria\n- [ ] Staging D1 database created\n- [ ] Production D1 database created\n- [ ] Database IDs added to wrangler.toml\n- [ ] `wrangler d1 list` shows both databases","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-13T21:36:21.794993-06:00","updated_at":"2025-12-13T22:27:57.367585-06:00","closed_at":"2025-12-13T22:27:57.367585-06:00","dependencies":[{"issue_id":"zine-udw-1-3","depends_on_id":"zine-udw.1","type":"parent-child","created_at":"2025-12-13T21:36:21.795324-06:00","created_by":"daemon"}]}
{"id":"zine-udw-1-4","title":"Create drizzle.config.ts for D1","description":"Create Drizzle Kit configuration for D1 migrations.\n\n## New File\n```typescript\n// apps/worker/drizzle.config.ts\nimport { defineConfig } from 'drizzle-kit';\n\nexport default defineConfig({\n  schema: './src/db/schema.ts',\n  out: './src/db/migrations',\n  dialect: 'sqlite',\n  driver: 'd1-http',\n  dbCredentials: {\n    accountId: process.env.CLOUDFLARE_ACCOUNT_ID!,\n    databaseId: process.env.D1_DATABASE_ID!,\n    token: process.env.CLOUDFLARE_API_TOKEN!,\n  },\n});\n```\n\n## Add npm scripts\n```json\n{\n  \"scripts\": {\n    \"db:generate\": \"drizzle-kit generate\",\n    \"db:migrate\": \"drizzle-kit migrate\",\n    \"db:push\": \"drizzle-kit push\",\n    \"db:studio\": \"drizzle-kit studio\"\n  }\n}\n```\n\n## Files\n- apps/worker/drizzle.config.ts (new)\n- apps/worker/package.json (add scripts)\n\n## Acceptance Criteria\n- [ ] drizzle.config.ts created\n- [ ] npm scripts added\n- [ ] `bun run db:generate` works (after schema exists)","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-13T21:36:27.953286-06:00","updated_at":"2025-12-13T22:27:26.71353-06:00","closed_at":"2025-12-13T22:27:26.71353-06:00","dependencies":[{"issue_id":"zine-udw-1-4","depends_on_id":"zine-udw.1","type":"parent-child","created_at":"2025-12-13T21:36:27.953709-06:00","created_by":"daemon"}]}
{"id":"zine-udw.1","title":"Phase 0: Infrastructure Setup","description":"Set up the foundational infrastructure for the new architecture.\n\n## Tasks\n1. Add D1 + Drizzle + tRPC dependencies to worker\n2. Create D1 databases in Cloudflare (staging + production)\n3. Configure wrangler.toml with D1 bindings (remove DO bindings)\n4. Create drizzle.config.ts for migrations\n\n## Parallelization\n- Tasks 1, 2 can run in parallel\n- Task 3 depends on Task 2 (needs DB IDs)\n- Task 4 depends on Task 1 (needs drizzle-kit installed)\n\n## Acceptance Criteria\n- [ ] All dependencies installed and importable\n- [ ] D1 databases created and IDs recorded\n- [ ] wrangler.toml updated with D1 bindings, DO bindings removed\n- [ ] drizzle-kit commands work","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-13T21:36:00.455774-06:00","updated_at":"2025-12-13T22:27:17.853553-06:00","closed_at":"2025-12-13T22:27:17.853553-06:00","dependencies":[{"issue_id":"zine-udw.1","depends_on_id":"zine-udw","type":"parent-child","created_at":"2025-12-13T21:36:00.456164-06:00","created_by":"daemon"}]}
{"id":"zine-udw.2","title":"Phase 1: Database Schema \u0026 tRPC Foundation","description":"Create the database schema and tRPC foundation.\n\n## Tasks\n1. Create Drizzle schema (users, items, userItems, sources, providerItemsSeen)\n2. Create D1 database initialization module\n3. Generate and apply initial migration\n4. Create tRPC instance with superjson transformer\n5. Create tRPC context with auth and DB\n6. Update auth middleware for tRPC context\n7. Update types.ts with DB binding\n\n## Parallelization\n- Schema track (1→2→3) and tRPC track (4→5) can run in parallel\n- Task 6 is independent\n- Task 7 depends on wrangler.toml being updated\n\n## Dependencies\n- Requires Phase 0 complete\n\n## Acceptance Criteria\n- [ ] Drizzle schema created with all 5 tables\n- [ ] Migrations applied to local D1\n- [ ] tRPC instance with protected procedure working\n- [ ] Auth middleware sets userId for tRPC context","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-13T21:36:00.548219-06:00","updated_at":"2025-12-13T22:27:35.171895-06:00","closed_at":"2025-12-13T22:27:35.171895-06:00","dependencies":[{"issue_id":"zine-udw.2","depends_on_id":"zine-udw","type":"parent-child","created_at":"2025-12-13T21:36:00.548584-06:00","created_by":"daemon"}]}
{"id":"zine-udw.3","title":"Phase 2: Delete Durable Objects \u0026 Sync Code","description":"**IMPORTANT: This phase was incorrectly numbered. Execute AFTER Phase 4 (tRPC Routers).**\n\nDelete the old Durable Objects and Replicache sync code from the worker.\n\n## Tasks\n1. Delete entire durable-objects directory\n2. Delete sync routes (sync.ts, sync.test.ts)\n3. Delete DO-specific db utilities (lib/db.ts)\n4. Refactor auth routes to use D1 instead of DO\n\n## Critical Dependency\n- **Must wait for tRPC routers to be integrated with Hono (zine-6zg)**\n- Deleting before the new API is wired up will break the app\n\n## Acceptance Criteria\n- [ ] No durable-objects directory exists\n- [ ] No sync routes exist\n- [ ] No references to USER_DO in codebase\n- [ ] Auth routes use D1 for user management","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-13T21:36:00.640485-06:00","updated_at":"2025-12-13T21:46:25.525844-06:00","dependencies":[{"issue_id":"zine-udw.3","depends_on_id":"zine-udw","type":"parent-child","created_at":"2025-12-13T21:36:00.640848-06:00","created_by":"daemon"}]}
{"id":"zine-udw.4","title":"Phase 3: Implement tRPC Routers","description":"**Execute BEFORE Phase 3 (Delete Old Code).**\n\nImplement the tRPC routers with mock data first approach.\n\n## Tasks\n1. Create mock data file with realistic ItemView examples\n2. Create items router (inbox, library, home, get, bookmark, archive, updateProgress)\n3. Create sources router (list, add, remove)\n4. Create root router combining items + sources\n5. Add tRPC type exports to worker package.json\n6. Integrate tRPC with Hono entry point\n\n## Parallelization\n- Items router and sources router can be developed in parallel\n- Root router depends on both sub-routers\n- Integration depends on root router + auth middleware\n\n## Dependencies\n- Requires Phase 1 complete (tRPC instance, context)\n\n## Acceptance Criteria\n- [ ] All tRPC procedures return mock data\n- [ ] /trpc/* routes accessible with auth\n- [ ] AppRouter type exported from worker\n- [ ] Mobile can import type from @zine/worker/trpc","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-13T21:36:00.736188-06:00","updated_at":"2025-12-13T21:46:32.038996-06:00","dependencies":[{"issue_id":"zine-udw.4","depends_on_id":"zine-udw","type":"parent-child","created_at":"2025-12-13T21:36:00.736603-06:00","created_by":"daemon"}]}
{"id":"zine-udw.5","title":"Phase 4: Mobile Client Migration","description":"Migrate the mobile app from Replicache to tRPC + React Query.\n\n## Tasks\n1. Add tRPC and React Query dependencies\n2. Create tRPC client (lib/trpc.ts)\n3. Create TRPCProvider with Clerk auth integration\n4. Update _layout.tsx to use TRPCProvider\n5. Create new hooks using tRPC (useInboxItems, useLibraryItems, etc.)\n6. Implement optimistic updates for mutations\n7. Delete Replicache files (only after new hooks in place)\n\n## Parallelization\n- Track A: deps → client → provider → layout\n- Track B: new hooks → optimistic updates (parallel with Track A)\n- Track C: Delete files (after A and B complete)\n\n## Dependencies\n- Requires Phase 4 complete (tRPC types exported)\n\n## Acceptance Criteria\n- [ ] TRPCProvider wraps app in _layout.tsx\n- [ ] All screens use tRPC hooks for data\n- [ ] Optimistic updates work for bookmark/archive\n- [ ] No Replicache imports remain in mobile","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-13T21:36:00.828799-06:00","updated_at":"2025-12-13T21:46:38.199039-06:00","dependencies":[{"issue_id":"zine-udw.5","depends_on_id":"zine-udw","type":"parent-child","created_at":"2025-12-13T21:36:00.829206-06:00","created_by":"daemon"}]}
{"id":"zine-udw.6","title":"Phase 5: Shared Package Cleanup","description":"Clean up the shared package by removing Replicache-specific code.\n\n## Tasks\n1. Delete sync types (types/sync.ts)\n2. Delete mutators (mutators/index.ts)\n3. Delete key conventions (constants/keys.ts)\n4. Update schemas to remove sync schemas\n5. Update index.ts exports\n6. Remove Replicache peer dependency from package.json\n7. Update domain types for D1 schema (add userId, progress fields, etc.)\n\n## Critical Dependency\n- **Must wait for mobile to stop importing these modules (Phase 5 complete)**\n- Deleting while mobile still imports will cause build failures\n\n## Acceptance Criteria\n- [ ] No sync.ts, mutators/, or keys.ts exist\n- [ ] No Replicache in package.json\n- [ ] Domain types match D1 schema requirements\n- [ ] TypeScript compilation succeeds","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-13T21:36:00.917262-06:00","updated_at":"2025-12-13T21:46:43.345023-06:00","dependencies":[{"issue_id":"zine-udw.6","depends_on_id":"zine-udw","type":"parent-child","created_at":"2025-12-13T21:36:00.917616-06:00","created_by":"daemon"}]}
{"id":"zine-udw.7","title":"Phase 6: Testing \u0026 Validation","description":"Write tests and verify the migration is complete.\n\n## Tasks\n1. Create items router unit tests\n2. Create sources router unit tests\n3. Create database query tests\n4. Create API integration tests\n5. Verify CI pipeline passes\n\n## Notes\n- Can start incrementally during earlier phases\n- Unit tests can be written alongside router implementation\n- Integration tests require full API to be wired up\n\n## Acceptance Criteria\n- [ ] All tRPC procedures have unit tests\n- [ ] Database queries tested with realistic data\n- [ ] Full auth → API → DB flow tested\n- [ ] CI passes: build, lint, test, deploy to staging","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-13T21:36:01.007877-06:00","updated_at":"2025-12-13T21:46:47.322603-06:00","dependencies":[{"issue_id":"zine-udw.7","depends_on_id":"zine-udw","type":"parent-child","created_at":"2025-12-13T21:36:01.008306-06:00","created_by":"daemon"}]}
{"id":"zine-uoo","title":"Add D1 + Drizzle dependencies to worker","description":"Add required dependencies for the new architecture:\n\n## Dependencies to Add\n```json\n{\n  \"dependencies\": {\n    \"drizzle-orm\": \"^0.34.0\",\n    \"@hono/trpc-server\": \"^0.3.0\",\n    \"@trpc/server\": \"^11.0.0\"\n  },\n  \"devDependencies\": {\n    \"drizzle-kit\": \"^0.28.0\"\n  }\n}\n```\n\n## Files\n- apps/worker/package.json\n\n## Acceptance Criteria\n- [ ] drizzle-orm added to dependencies\n- [ ] drizzle-kit added to devDependencies\n- [ ] @hono/trpc-server added\n- [ ] @trpc/server added\n- [ ] bun install succeeds","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-13T21:36:57.410333-06:00","updated_at":"2025-12-13T21:46:04.300468-06:00","closed_at":"2025-12-13T21:46:04.300468-06:00"}
{"id":"zine-vn5","title":"Add scheduled handler for ingestion","description":"Implement the scheduled worker handler for content ingestion.\n\n## Implementation\n### Update apps/worker/src/index.ts\n```typescript\nexport default {\n  fetch: app.fetch,\n  async scheduled(event: ScheduledEvent, env: Bindings, ctx: ExecutionContext) {\n    ctx.waitUntil(runIngestionBatch(env));\n  },\n};\n```\n\n### Create apps/worker/src/ingestion/index.ts\n```typescript\nasync function runIngestionBatch(env: Bindings) {\n  const db = drizzle(env.DB);\n  const activeSources = await db.select()\n    .from(sources)\n    .where(isNull(sources.deletedAt));\n\n  for (const source of activeSources) {\n    try {\n      await ingestSource(db, source);\n    } catch (error) {\n      console.error(`Ingestion failed for source ${source.id}:`, error);\n    }\n  }\n}\n```\n\n## Cron Configuration\nAdd to wrangler.toml:\n```toml\n[triggers]\ncrons = [\"0 * * * *\"]\n```\n\n## Depends On\n- D1 schema and queries working\n- Ingestion design documented","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-13T21:40:34.804351-06:00","updated_at":"2025-12-13T21:40:34.804351-06:00"}
